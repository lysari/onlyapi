# Internationalisation (i18n)

onlyApi supports 5 languages for API error messages and responses. Language negotiation follows RFC 7231.

---

## Supported Locales

| Code | Language |
|------|----------|
| `en` | English (default) |
| `es` | Spanish |
| `fr` | French |
| `de` | German |
| `ja` | Japanese |

---

## Configuration

```env
I18N_DEFAULT_LOCALE=en
I18N_SUPPORTED_LOCALES=en,es,fr,de,ja
```

| Variable | Default | Description |
|----------|---------|-------------|
| `I18N_DEFAULT_LOCALE` | `en` | Fallback locale when no `Accept-Language` matches |
| `I18N_SUPPORTED_LOCALES` | `en` | Comma-separated list of enabled locales |

---

## How It Works

### 1. Client Sends `Accept-Language` Header

```http
GET /api/v1/users/me
Accept-Language: es,en;q=0.5
```

### 2. Server Resolves Best Locale

The server parses the `Accept-Language` header according to RFC 7231:

1. Parse quality values (e.g., `es` = 1.0, `en` = 0.5)
2. Sort by quality (highest first)
3. Match against `I18N_SUPPORTED_LOCALES`
4. Fall back to `I18N_DEFAULT_LOCALE` if no match

### 3. Response Includes `Content-Language`

```http
HTTP/1.1 401 Unauthorized
Content-Language: es

{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Token inválido o expirado"
  }
}
```

---

## Message Keys

The following message keys are translated across all 5 languages:

### Authentication

| Key | English |
|-----|---------|
| `auth.invalid_credentials` | Invalid email or password |
| `auth.token_expired` | Token has expired |
| `auth.token_invalid` | Invalid or expired token |
| `auth.unauthorized` | Authentication required |
| `auth.forbidden` | Insufficient permissions |
| `auth.email_taken` | Email already registered |
| `auth.account_locked` | Account temporarily locked |
| `auth.mfa_required` | Multi-factor authentication required |
| `auth.mfa_invalid_code` | Invalid verification code |
| `auth.email_not_verified` | Email not verified |
| `auth.password_expired` | Password has expired, please reset it |

### Validation

| Key | English |
|-----|---------|
| `validation.required` | This field is required |
| `validation.invalid_email` | Invalid email format |
| `validation.password_too_short` | Password must be at least {min} characters |
| `validation.password_too_long` | Password must not exceed {max} characters |
| `validation.password_no_uppercase` | Password must contain an uppercase letter |
| `validation.password_no_lowercase` | Password must contain a lowercase letter |
| `validation.password_no_digit` | Password must contain a digit |
| `validation.password_no_special` | Password must contain a special character |
| `validation.password_reused` | Password was used recently |
| `validation.invalid_format` | Invalid format |

### User

| Key | English |
|-----|---------|
| `user.not_found` | User not found |
| `user.deleted` | Account deleted successfully |
| `user.updated` | Profile updated successfully |

### Server

| Key | English |
|-----|---------|
| `server.internal_error` | An unexpected error occurred |
| `server.rate_limited` | Too many requests. Please try again later. |
| `server.service_unavailable` | Service temporarily unavailable |
| `server.not_found` | Route not found |

---

## Usage Examples

### Spanish

```bash
curl http://localhost:3000/api/v1/users/me \
  -H "Accept-Language: es"
```

```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Se requiere autenticación"
  }
}
```

### Japanese

```bash
curl http://localhost:3000/api/v1/users/me \
  -H "Accept-Language: ja"
```

```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "認証が必要です"
  }
}
```

### French with Fallback

```bash
curl http://localhost:3000/api/v1/users/me \
  -H "Accept-Language: fr-CA,fr;q=0.9,en;q=0.5"
```

Resolves to `fr` (exact match for `fr`, regional variant `fr-CA` falls back to `fr`).

### Unsupported Language Falls Back

```bash
curl http://localhost:3000/api/v1/users/me \
  -H "Accept-Language: ko"
```

Korean is not supported → falls back to `I18N_DEFAULT_LOCALE` (default: `en`).

---

## Adding a New Language

1. Open `src/presentation/i18n/index.ts`
2. Add a new locale catalog with all message keys
3. Add the locale code to `I18N_SUPPORTED_LOCALES` in your `.env`

Example — adding Portuguese (`pt`):

```typescript
const pt: MessageCatalog = {
  "auth.invalid_credentials": "Email ou senha inválidos",
  "auth.token_expired": "Token expirado",
  // ... all other keys
};
```

Then update your configuration:

```env
I18N_SUPPORTED_LOCALES=en,es,fr,de,ja,pt
```
